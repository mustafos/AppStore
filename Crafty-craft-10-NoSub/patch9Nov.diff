From d351818ed7f0e7fe9b0fe1a06845e93f83c5b893 Mon Sep 17 00:00:00 2001
From: VitalyPolezhay <>
Date: Fri, 10 Nov 2023 14:44:53 +0200
Subject: [PATCH] fixed bug fix (9 November)

---
 Crafty Craft 5/Flow/configs/IAPHandler.swift  |  1 -
 Crafty Craft 5/SceneDelegate.swift            |  4 ++--
 .../en-AU.lproj/Localizable.strings           |  2 ++
 .../en-IN.lproj/Localizable.strings           |  2 ++
 .../localizable/en.lproj/Localizable.strings  |  2 ++
 .../AddonEditor3DViewController.swift         | 11 ++++++---
 .../AddonEditor3DViewController.xib           |  4 ++--
 ...AddonEditor3DViewController+Gestures.swift |  4 +++-
 .../AddonEditorViewController.swift           |  7 +++++-
 .../AddonEditorSelectorViewController.swift   |  1 +
 .../AddonEditorSelectorViewController.xib     |  6 ++---
 .../SkinCreatorController/ColorManger.swift   | 24 +++++++++----------
 .../SkinCreatorViewController+PixelView.swift |  2 +-
 .../3dModel/EditorSkinModel.swift             |  2 +-
 .../Skin3DCreator/ColorManager3D.swift        | 22 ++++++++---------
 .../Skin3DTestViewController.swift            |  2 +-
 16 files changed, 57 insertions(+), 39 deletions(-)

diff --git a/Crafty Craft 5/Flow/configs/IAPHandler.swift b/Crafty Craft 5/Flow/configs/IAPHandler.swift
index f7edf01..d45e2e2 100644
--- a/Crafty Craft 5/Flow/configs/IAPHandler.swift	
+++ b/Crafty Craft 5/Flow/configs/IAPHandler.swift	
@@ -144,7 +144,6 @@ class IAPManager: NSObject, SKPaymentTransactionObserver, SKProductsRequestDeleg
         isRestoreTransaction = false
     }
     
-    
     private func completeRestoredStatusFunc(restoreProductID : String, transaction: SKPaymentTransaction) {
         if restoringTransactionProductId.contains(restoreProductID) { return }
         restoringTransactionProductId.append(restoreProductID)
diff --git a/Crafty Craft 5/SceneDelegate.swift b/Crafty Craft 5/SceneDelegate.swift
index c0ff8be..6d04807 100755
--- a/Crafty Craft 5/SceneDelegate.swift	
+++ b/Crafty Craft 5/SceneDelegate.swift	
@@ -21,8 +21,8 @@ final class SceneDelegate: UIResponder, UIWindowSceneDelegate {
                 DispatchQueue.main.asyncAfter(deadline: .now() + 2) {
                     switch isPur {
                     case true: self.l0adApp()
-                    case false: self.l0adApp()
-//                    case false: self.loadSubscription()
+//                    case false: self.l0adApp()
+                    case false: self.loadSubscription()
                     }
                 }
                 //             Validate ContentProductSub
diff --git a/Crafty Craft 5/Subscription/localizable/en-AU.lproj/Localizable.strings b/Crafty Craft 5/Subscription/localizable/en-AU.lproj/Localizable.strings
index 4a32801..bc92a33 100644
--- a/Crafty Craft 5/Subscription/localizable/en-AU.lproj/Localizable.strings	
+++ b/Crafty Craft 5/Subscription/localizable/en-AU.lproj/Localizable.strings	
@@ -66,3 +66,5 @@
 "inval_prod_id" = "Looks like you have bad Internet connection";
 
 
+"faledRestore" = "Failed to restore";
+"notPurchases" = "No Purchases";
diff --git a/Crafty Craft 5/Subscription/localizable/en-IN.lproj/Localizable.strings b/Crafty Craft 5/Subscription/localizable/en-IN.lproj/Localizable.strings
index 4a32801..bc92a33 100644
--- a/Crafty Craft 5/Subscription/localizable/en-IN.lproj/Localizable.strings	
+++ b/Crafty Craft 5/Subscription/localizable/en-IN.lproj/Localizable.strings	
@@ -66,3 +66,5 @@
 "inval_prod_id" = "Looks like you have bad Internet connection";
 
 
+"faledRestore" = "Failed to restore";
+"notPurchases" = "No Purchases";
diff --git a/Crafty Craft 5/Subscription/localizable/en.lproj/Localizable.strings b/Crafty Craft 5/Subscription/localizable/en.lproj/Localizable.strings
index 4a32801..bc92a33 100644
--- a/Crafty Craft 5/Subscription/localizable/en.lproj/Localizable.strings	
+++ b/Crafty Craft 5/Subscription/localizable/en.lproj/Localizable.strings	
@@ -66,3 +66,5 @@
 "inval_prod_id" = "Looks like you have bad Internet connection";
 
 
+"faledRestore" = "Failed to restore";
+"notPurchases" = "No Purchases";
diff --git a/Crafty Craft 5/Tab Bar/Create Tab/Addon Creator/AddonEditor3DModule/AddonEditor3DViewController.swift b/Crafty Craft 5/Tab Bar/Create Tab/Addon Creator/AddonEditor3DModule/AddonEditor3DViewController.swift
index e0ccdd4..4da2821 100755
--- a/Crafty Craft 5/Tab Bar/Create Tab/Addon Creator/AddonEditor3DModule/AddonEditor3DViewController.swift	
+++ b/Crafty Craft 5/Tab Bar/Create Tab/Addon Creator/AddonEditor3DModule/AddonEditor3DViewController.swift	
@@ -410,9 +410,14 @@ class AddonEditor3DViewController: UIViewController {
         skinNameLabel.isHidden = true
         saveButton.isHidden = true
         rotationSkinModelButton.isHidden = true
-        customToolPicker.isHidden = true
-        brashSizeView.isHidden = true
-        colorsBrashContainerView.isHidden = true
+        
+        
+        customToolPicker.alpha = 0
+        brashSizeView.alpha = 0
+        colorsBrashContainerView.alpha = 0
+        customToolPicker.isUserInteractionEnabled = false
+        brashSizeView.isUserInteractionEnabled = false
+        colorsBrashContainerView.isUserInteractionEnabled = false
         
         panForColorPickerRecognizer.isEnabled = false
         tapGestureOnSCNScene.isEnabled = false
diff --git a/Crafty Craft 5/Tab Bar/Create Tab/Addon Creator/AddonEditor3DModule/AddonEditor3DViewController.xib b/Crafty Craft 5/Tab Bar/Create Tab/Addon Creator/AddonEditor3DModule/AddonEditor3DViewController.xib
index 1189013..5b47b24 100755
--- a/Crafty Craft 5/Tab Bar/Create Tab/Addon Creator/AddonEditor3DModule/AddonEditor3DViewController.xib	
+++ b/Crafty Craft 5/Tab Bar/Create Tab/Addon Creator/AddonEditor3DModule/AddonEditor3DViewController.xib	
@@ -1,9 +1,9 @@
 <?xml version="1.0" encoding="UTF-8"?>
-<document type="com.apple.InterfaceBuilder3.CocoaTouch.XIB" version="3.0" toolsVersion="21507" targetRuntime="iOS.CocoaTouch" propertyAccessControl="none" useAutolayout="YES" useTraitCollections="YES" useSafeAreas="YES" colorMatched="YES">
+<document type="com.apple.InterfaceBuilder3.CocoaTouch.XIB" version="3.0" toolsVersion="22155" targetRuntime="iOS.CocoaTouch" propertyAccessControl="none" useAutolayout="YES" useTraitCollections="YES" useSafeAreas="YES" colorMatched="YES">
     <device id="retina6_72" orientation="portrait" appearance="light"/>
     <dependencies>
         <deployment identifier="iOS"/>
-        <plugIn identifier="com.apple.InterfaceBuilder.IBCocoaTouchPlugin" version="21505"/>
+        <plugIn identifier="com.apple.InterfaceBuilder.IBCocoaTouchPlugin" version="22131"/>
         <capability name="Named colors" minToolsVersion="9.0"/>
         <capability name="Safe area layout guides" minToolsVersion="9.0"/>
         <capability name="documents saved in the Xcode 8 format" minToolsVersion="8.0"/>
diff --git a/Crafty Craft 5/Tab Bar/Create Tab/Addon Creator/AddonEditor3DModule/Extension_AddonEditor3DViewController+Gestures.swift b/Crafty Craft 5/Tab Bar/Create Tab/Addon Creator/AddonEditor3DModule/Extension_AddonEditor3DViewController+Gestures.swift
index 32184f5..3cecc3a 100644
--- a/Crafty Craft 5/Tab Bar/Create Tab/Addon Creator/AddonEditor3DModule/Extension_AddonEditor3DViewController+Gestures.swift	
+++ b/Crafty Craft 5/Tab Bar/Create Tab/Addon Creator/AddonEditor3DModule/Extension_AddonEditor3DViewController+Gestures.swift	
@@ -153,7 +153,9 @@ extension AddonEditor3DViewController {
             
         case .ended, .cancelled:
             if let pickedColor = magnifyingGlassView?.backgroundColor {
-                vcModel.editorAddonModel.colorManager3D.updateColorsArr(with: pickedColor)
+//                vcModel.editorAddonModel.colorManager3D.updateColorsArr(with: pickedColor)
+                vcModel.editorAddonModel.colorManager3D.addNewColor(color: pickedColor)
+
                 vcModel.editorAddonModel.currentDrawingColor = pickedColor
             }
             
diff --git a/Crafty Craft 5/Tab Bar/Create Tab/Addon Creator/AddonEditorController/AddonEditorViewController.swift b/Crafty Craft 5/Tab Bar/Create Tab/Addon Creator/AddonEditorController/AddonEditorViewController.swift
index 690185f..bbbc3b3 100644
--- a/Crafty Craft 5/Tab Bar/Create Tab/Addon Creator/AddonEditorController/AddonEditorViewController.swift	
+++ b/Crafty Craft 5/Tab Bar/Create Tab/Addon Creator/AddonEditorController/AddonEditorViewController.swift	
@@ -81,7 +81,12 @@ class AddonEditorViewController: UIViewController {
     }
     
     @IBAction func saveBtnTapped(_ sender: Any) {
-        showSaveIndicatorView()
+        //in general addon save preccess is long
+        //so show activity indicator
+        if model.allow3dEditing {
+            showSaveIndicatorView()
+        }
+        
         saveNewAddon()
     }
     
diff --git a/Crafty Craft 5/Tab Bar/Create Tab/Addon Creator/AddonEditorController/ListSelector/AddonEditorSelector/AddonEditorSelectorViewController.swift b/Crafty Craft 5/Tab Bar/Create Tab/Addon Creator/AddonEditorController/ListSelector/AddonEditorSelector/AddonEditorSelectorViewController.swift
index 56812c0..9efb3c2 100644
--- a/Crafty Craft 5/Tab Bar/Create Tab/Addon Creator/AddonEditorController/ListSelector/AddonEditorSelector/AddonEditorSelectorViewController.swift	
+++ b/Crafty Craft 5/Tab Bar/Create Tab/Addon Creator/AddonEditorController/ListSelector/AddonEditorSelector/AddonEditorSelectorViewController.swift	
@@ -92,6 +92,7 @@ class AddonEditorSelectorViewController: UIViewController {
     }
     
     private func setupSearchBar() {
+        searchBar.overrideUserInterfaceStyle = .dark
         searchBar.searchTextField.clearButtonMode = .never
     }
     
diff --git a/Crafty Craft 5/Tab Bar/Create Tab/Addon Creator/AddonEditorController/ListSelector/AddonEditorSelector/AddonEditorSelectorViewController.xib b/Crafty Craft 5/Tab Bar/Create Tab/Addon Creator/AddonEditorController/ListSelector/AddonEditorSelector/AddonEditorSelectorViewController.xib
index 300ca67..235a1e5 100644
--- a/Crafty Craft 5/Tab Bar/Create Tab/Addon Creator/AddonEditorController/ListSelector/AddonEditorSelector/AddonEditorSelectorViewController.xib	
+++ b/Crafty Craft 5/Tab Bar/Create Tab/Addon Creator/AddonEditorController/ListSelector/AddonEditorSelector/AddonEditorSelectorViewController.xib	
@@ -1,9 +1,9 @@
 <?xml version="1.0" encoding="UTF-8"?>
-<document type="com.apple.InterfaceBuilder3.CocoaTouch.XIB" version="3.0" toolsVersion="21507" targetRuntime="iOS.CocoaTouch" propertyAccessControl="none" useAutolayout="YES" useTraitCollections="YES" useSafeAreas="YES" colorMatched="YES">
+<document type="com.apple.InterfaceBuilder3.CocoaTouch.XIB" version="3.0" toolsVersion="22155" targetRuntime="iOS.CocoaTouch" propertyAccessControl="none" useAutolayout="YES" useTraitCollections="YES" useSafeAreas="YES" colorMatched="YES">
     <device id="retina6_72" orientation="portrait" appearance="light"/>
     <dependencies>
         <deployment identifier="iOS"/>
-        <plugIn identifier="com.apple.InterfaceBuilder.IBCocoaTouchPlugin" version="21505"/>
+        <plugIn identifier="com.apple.InterfaceBuilder.IBCocoaTouchPlugin" version="22131"/>
         <capability name="Named colors" minToolsVersion="9.0"/>
         <capability name="Safe area layout guides" minToolsVersion="9.0"/>
         <capability name="documents saved in the Xcode 8 format" minToolsVersion="8.0"/>
@@ -92,7 +92,7 @@
                                 <action selector="importTapped:" destination="-1" eventType="touchUpInside" id="kCe-t4-eKY"/>
                             </connections>
                         </button>
-                        <searchBar contentMode="redraw" searchBarStyle="minimal" text="" placeholder="Search" translucent="NO" translatesAutoresizingMaskIntoConstraints="NO" id="L44-Nq-zLr">
+                        <searchBar contentMode="redraw" searchBarStyle="minimal" text="" placeholder="Search" translatesAutoresizingMaskIntoConstraints="NO" id="L44-Nq-zLr">
                             <rect key="frame" x="10" y="10" width="373" height="56"/>
                             <color key="barTintColor" white="0.0" alpha="0.0" colorSpace="custom" customColorSpace="genericGamma22GrayColorSpace"/>
                             <textInputTraits key="textInputTraits"/>
diff --git a/Crafty Craft 5/Tab Bar/Create Tab/SkinsCreator/ListOfCreatedSkinsController/Skin2DCreator/BodyPart2DPickerVC/SkinCreatorController/ColorManger.swift b/Crafty Craft 5/Tab Bar/Create Tab/SkinsCreator/ListOfCreatedSkinsController/Skin2DCreator/BodyPart2DPickerVC/SkinCreatorController/ColorManger.swift
index 1e6695b..f7d5f7b 100644
--- a/Crafty Craft 5/Tab Bar/Create Tab/SkinsCreator/ListOfCreatedSkinsController/Skin2DCreator/BodyPart2DPickerVC/SkinCreatorController/ColorManger.swift	
+++ b/Crafty Craft 5/Tab Bar/Create Tab/SkinsCreator/ListOfCreatedSkinsController/Skin2DCreator/BodyPart2DPickerVC/SkinCreatorController/ColorManger.swift	
@@ -47,18 +47,18 @@ class ColorsManger {
 
     }
     
-//    func addNewColor(_ color: UIColor) {
-//        if !colorsArr.contains(color) && color != .clear && color.alpha != 0 {
-//
-//            if colorsArr.count == maxColors {
-//                colorsArr.removeLast()
-//            }
-//
-//            colorsArr.insert(color, at: 0)
-//            saveColorsToUserDefaults(colors: colorsArr)
-//            delegate?.updateCollection()
-//        }
-//    }
+    func addNewColor(_ color: UIColor) {
+        if  color != .clear && color.alpha != 0 {
+
+            if colorsArr.count == maxColors {
+                colorsArr.removeLast()
+            }
+
+            colorsArr.insert(color, at: 0)
+            saveColorsToUserDefaults(colors: colorsArr)
+            delegate?.updateCollection()
+        }
+    }
     
     func getColor(by index: Int ) -> UIColor {
         
diff --git a/Crafty Craft 5/Tab Bar/Create Tab/SkinsCreator/ListOfCreatedSkinsController/Skin2DCreator/BodyPart2DPickerVC/SkinCreatorController/SkinCreatorViewController+PixelView.swift b/Crafty Craft 5/Tab Bar/Create Tab/SkinsCreator/ListOfCreatedSkinsController/Skin2DCreator/BodyPart2DPickerVC/SkinCreatorController/SkinCreatorViewController+PixelView.swift
index 15366f5..5a5c960 100755
--- a/Crafty Craft 5/Tab Bar/Create Tab/SkinsCreator/ListOfCreatedSkinsController/Skin2DCreator/BodyPart2DPickerVC/SkinCreatorController/SkinCreatorViewController+PixelView.swift	
+++ b/Crafty Craft 5/Tab Bar/Create Tab/SkinsCreator/ListOfCreatedSkinsController/Skin2DCreator/BodyPart2DPickerVC/SkinCreatorController/SkinCreatorViewController+PixelView.swift	
@@ -76,7 +76,7 @@ extension SkinCreatorViewController : UIGestureRecognizerDelegate {
              
          case .ended, .cancelled:
              if let pickedColor = magnifyingGlassView?.backgroundColor {
-                 colorsManager.updateColorsArr(with: pickedColor)
+                 colorsManager.addNewColor(pickedColor)
                  _currentDrawingColor = pickedColor
              }
 //             getPixel
diff --git a/Crafty Craft 5/Tab Bar/Create Tab/SkinsCreator/ListOfCreatedSkinsController/Skin3DCreator/3dModel/EditorSkinModel.swift b/Crafty Craft 5/Tab Bar/Create Tab/SkinsCreator/ListOfCreatedSkinsController/Skin3DCreator/3dModel/EditorSkinModel.swift
index 220b9d7..c96dfa0 100644
--- a/Crafty Craft 5/Tab Bar/Create Tab/SkinsCreator/ListOfCreatedSkinsController/Skin3DCreator/3dModel/EditorSkinModel.swift	
+++ b/Crafty Craft 5/Tab Bar/Create Tab/SkinsCreator/ListOfCreatedSkinsController/Skin3DCreator/3dModel/EditorSkinModel.swift	
@@ -64,7 +64,7 @@ class EditorSkinModel {
     }
     
     func addNewColorToPalitrs(_ newColor: UIColor) {
-        controller.colorManager3D.updateColorsArr(with: newColor)
+        controller.colorManager3D.addNewColor(color: newColor)
     }
     
     private func getColorsFromAssemblyDiagram(skinAssemblyDiagram: UIImage) {
diff --git a/Crafty Craft 5/Tab Bar/Create Tab/SkinsCreator/ListOfCreatedSkinsController/Skin3DCreator/ColorManager3D.swift b/Crafty Craft 5/Tab Bar/Create Tab/SkinsCreator/ListOfCreatedSkinsController/Skin3DCreator/ColorManager3D.swift
index 0d43cb9..a8c1cc5 100644
--- a/Crafty Craft 5/Tab Bar/Create Tab/SkinsCreator/ListOfCreatedSkinsController/Skin3DCreator/ColorManager3D.swift	
+++ b/Crafty Craft 5/Tab Bar/Create Tab/SkinsCreator/ListOfCreatedSkinsController/Skin3DCreator/ColorManager3D.swift	
@@ -57,17 +57,17 @@ class ColorManager3D {
         }
     }
     
-//    func addNewColor(color: UIColor) {
-//        if color != .clear, color.alpha != 0 {
-//            if colorsArr.count == maxColors {
-//                colorsArr.removeLast()
-//            }
-//
-//            colorsArr.insert(color, at: 0)
-//            saveColorsToUserDefaults(colors: colorsArr)
-//            delegate?.updateCollection()
-//        }
-//    }
+    func addNewColor(color: UIColor) {
+        if color != .clear, color.alpha != 0 {
+            if colorsArr.count == maxColors {
+                colorsArr.removeLast()
+            }
+
+            colorsArr.insert(color, at: 0)
+            saveColorsToUserDefaults(colors: colorsArr)
+            delegate?.updateCollection()
+        }
+    }
     
     func getColor(by index: Int ) -> UIColor {
         
diff --git a/Crafty Craft 5/Tab Bar/Create Tab/SkinsCreator/ListOfCreatedSkinsController/Skin3DCreator/Skin3DTestViewController.swift b/Crafty Craft 5/Tab Bar/Create Tab/SkinsCreator/ListOfCreatedSkinsController/Skin3DCreator/Skin3DTestViewController.swift
index d94868e..c291a45 100755
--- a/Crafty Craft 5/Tab Bar/Create Tab/SkinsCreator/ListOfCreatedSkinsController/Skin3DCreator/Skin3DTestViewController.swift	
+++ b/Crafty Craft 5/Tab Bar/Create Tab/SkinsCreator/ListOfCreatedSkinsController/Skin3DCreator/Skin3DTestViewController.swift	
@@ -259,7 +259,7 @@ class Skin3DTestViewController: UIViewController {
     }
     
     override func viewWillAppear(_ animated: Bool) {
-        sceneView.defaultCameraController.rotateBy(x: 0.01, y: 0.01) // just init inner property (fixed bug with flickers)
+        sceneView.defaultCameraController.rotateBy(x: 1.1, y: 1.1) // just init inner property (fixed bug with flickers)
     }
     
     deinit {
-- 
2.37.0

From 861ea46ee4d01b1b64b43e352d27d512f08abe30 Mon Sep 17 00:00:00 2001
From: VitalyPolezhay <>
Date: Fri, 10 Nov 2023 15:07:11 +0200
Subject: [PATCH] updated pushwoosh

---
 Crafty Craft 5/Configurations/Configurations.swift | 2 +-
 Crafty Craft 5/Resources/Info.plist                | 2 --
 NotificationService/Info.plist                     | 2 --
 3 files changed, 1 insertion(+), 5 deletions(-)

diff --git a/Crafty Craft 5/Configurations/Configurations.swift b/Crafty Craft 5/Configurations/Configurations.swift
index e2bd35e..73659f4 100644
--- a/Crafty Craft 5/Configurations/Configurations.swift	
+++ b/Crafty Craft 5/Configurations/Configurations.swift	
@@ -13,7 +13,7 @@ enum Configurations {
     static let subFontUrl = Bundle.main.url(forResource: "sub", withExtension: "ttf")!
     static let adjustToken = "hfg1t85ufqbk"
     
-    static let pushwooshToken = "56F9A-A546D"
+    static let pushwooshToken = "356AE-8AB06"
     static let pushwooshAppName = "test"
     
     static let termsLink: String = "https://www.google.com"
diff --git a/Crafty Craft 5/Resources/Info.plist b/Crafty Craft 5/Resources/Info.plist
index dc716f9..0d69589 100755
--- a/Crafty Craft 5/Resources/Info.plist	
+++ b/Crafty Craft 5/Resources/Info.plist	
@@ -23,8 +23,6 @@
 		<string>dbapi-8-emm</string>
 		<string>dbapi-2</string>
 	</array>
-	<key>Pushwoosh_APPID</key>
-	<string>56F9A-A546D</string>
 	<key>SKAdNetworkItems</key>
 	<array>
 		<dict>
diff --git a/NotificationService/Info.plist b/NotificationService/Info.plist
index a7787a5..57421eb 100644
--- a/NotificationService/Info.plist
+++ b/NotificationService/Info.plist
@@ -8,8 +8,6 @@
 		<string>com.apple.usernotifications.service</string>
 		<key>NSExtensionPrincipalClass</key>
 		<string>$(PRODUCT_MODULE_NAME).NotificationService</string>
-		<key>Pushwoosh_APPID</key>
-		<string>56F9A-A546D</string>
 	</dict>
 </dict>
 </plist>
-- 
2.37.0


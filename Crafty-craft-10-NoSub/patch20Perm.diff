From ed8012fb72df90790ec2de6fc2f81c5348602592 Mon Sep 17 00:00:00 2001
From: VitalyPolezhay <>
Date: Mon, 20 Nov 2023 14:17:09 +0200
Subject: [PATCH] updated photo library perm.

---
 .../Manager/PhotoGalleryManager.swift          | 18 +++++++++---------
 .../ContentViewController+SaveImage.swift      |  2 +-
 .../AddonEditor3DModel.swift                   |  2 +-
 ...xtension_EditorSkinModel+SaveAndShare.swift |  2 +-
 4 files changed, 12 insertions(+), 12 deletions(-)

diff --git a/Crafty Craft 5/Manager/PhotoGalleryManager.swift b/Crafty Craft 5/Manager/PhotoGalleryManager.swift
index 219e181..e512fe8 100644
--- a/Crafty Craft 5/Manager/PhotoGalleryManager.swift	
+++ b/Crafty Craft 5/Manager/PhotoGalleryManager.swift	
@@ -27,22 +27,22 @@ class PhotoGalleryManager: NSObject, PhotoGalleryManagerProtocol {
         
         self.getImageCompletion = completion
         
-        requestAuthorizationAndSaveImageToLibrary(from: viewController) { [weak self] granted, vc in
+//        requestAuthorizationAndSaveImageToLibrary(from: viewController) { [weak self] granted, vc in
             DispatchQueue.main.async {
                 
-                guard let me = self else {
-                    assert(false, "wrong construction")
-                    return
-                }
+//                guard let me = self else {
+//                    assert(false, "wrong construction")
+//                    return
+//                }
                 
                 let imagePicker = UIImagePickerController()
-                imagePicker.delegate = me
+                imagePicker.delegate = self
                 imagePicker.sourceType = .photoLibrary
                 imagePicker.allowsEditing = false
                 
-                vc?.present(imagePicker, animated: true)
+                viewController.present(imagePicker, animated: true)
             }
-        }
+//        }
     }
     
     func getImageFromCamera(from viewController: UIViewController, completion: @escaping GetImageCompletion) {
@@ -94,7 +94,7 @@ class PhotoGalleryManager: NSObject, PhotoGalleryManagerProtocol {
     }
     
     private func requestAuthorizationAndSaveImageToLibrary(from viewController: UIViewController, completion: @escaping (Bool, UIViewController?) -> ()) {
-        PHPhotoLibrary.requestAuthorization { [weak self, viewController] (status) in
+        PHPhotoLibrary.requestAuthorization(for: .addOnly) { [weak self, viewController] (status) in
             switch status {
             case .authorized:
                 completion(true, viewController)
diff --git a/Crafty Craft 5/Tab Bar/Content Tab/Content Module/ContentViewController+SaveImage.swift b/Crafty Craft 5/Tab Bar/Content Tab/Content Module/ContentViewController+SaveImage.swift
index 3b0d8a7..8f137b3 100644
--- a/Crafty Craft 5/Tab Bar/Content Tab/Content Module/ContentViewController+SaveImage.swift	
+++ b/Crafty Craft 5/Tab Bar/Content Tab/Content Module/ContentViewController+SaveImage.swift	
@@ -12,7 +12,7 @@ import UIKit
 
 extension ContentViewController {
     func requestAuthorizationAndSaveImageToLibrary(image: UIImage) {
-        PHPhotoLibrary.requestAuthorization { [weak self] (status) in
+        PHPhotoLibrary.requestAuthorization(for: .addOnly) { [weak self] (status) in
             switch status {
             case .authorized:
                 self?.saveImageToPhotoLibrary(image: image)
diff --git a/Crafty Craft 5/Tab Bar/Create Tab/Addon Creator/AddonEditor3DModule/AddonEditor3DModel.swift b/Crafty Craft 5/Tab Bar/Create Tab/Addon Creator/AddonEditor3DModule/AddonEditor3DModel.swift
index 0b1bacb..e13f416 100644
--- a/Crafty Craft 5/Tab Bar/Create Tab/Addon Creator/AddonEditor3DModule/AddonEditor3DModel.swift	
+++ b/Crafty Craft 5/Tab Bar/Create Tab/Addon Creator/AddonEditor3DModule/AddonEditor3DModel.swift	
@@ -298,7 +298,7 @@ extension AddonEditor3DVCModel {
     }
     
     func requestAuthorizationAndSaveImageToLibrary(image: UIImage) {
-        PHPhotoLibrary.requestAuthorization { [weak self] (status) in
+        PHPhotoLibrary.requestAuthorization(for: .addOnly) { [weak self] (status) in
             switch status {
             case .authorized:
                 self?.saveImageToPhotoLibrary(image: image)
diff --git a/Crafty Craft 5/Tab Bar/Create Tab/SkinsCreator/ListOfCreatedSkinsController/Skin3DCreator/3dModel/Extension_EditorSkinModel+SaveAndShare.swift b/Crafty Craft 5/Tab Bar/Create Tab/SkinsCreator/ListOfCreatedSkinsController/Skin3DCreator/3dModel/Extension_EditorSkinModel+SaveAndShare.swift
index 9b07e15..4330b65 100644
--- a/Crafty Craft 5/Tab Bar/Create Tab/SkinsCreator/ListOfCreatedSkinsController/Skin3DCreator/3dModel/Extension_EditorSkinModel+SaveAndShare.swift	
+++ b/Crafty Craft 5/Tab Bar/Create Tab/SkinsCreator/ListOfCreatedSkinsController/Skin3DCreator/3dModel/Extension_EditorSkinModel+SaveAndShare.swift	
@@ -36,7 +36,7 @@ extension EditorSkinModel {
     }
     
     func requestAuthorizationAndSaveImageToLibrary(image: UIImage) {
-        PHPhotoLibrary.requestAuthorization { [weak self] (status) in
+        PHPhotoLibrary.requestAuthorization(for: .addOnly){ [weak self] (status) in
             switch status {
             case .authorized:
                 self?.saveImageToPhotoLibrary(image: image)
-- 
2.37.0


From 5e7232ea3d9e715f803a961f09c7ba0b0a4aaddf Mon Sep 17 00:00:00 2001
From: VitalyPolezhay <>
Date: Wed, 15 Nov 2023 11:30:48 +0200
Subject: [PATCH] fixed bugs 5, 7,8,9

---
 .../AddonEditorModel.swift                    |  2 +-
 .../AddonEditorViewController.swift           |  7 ++-
 .../AddonEditorViewController.xib             | 58 +++++++++++--------
 .../Create Tab/CreateTabViewController.swift  |  1 +
 .../Skin3DTestViewController.swift            | 10 +++-
 5 files changed, 50 insertions(+), 28 deletions(-)

diff --git a/Crafty Craft 5/Tab Bar/Create Tab/Addon Creator/AddonEditorController/AddonEditorModel.swift b/Crafty Craft 5/Tab Bar/Create Tab/Addon Creator/AddonEditorController/AddonEditorModel.swift
index a5f55f9..2399a21 100644
--- a/Crafty Craft 5/Tab Bar/Create Tab/Addon Creator/AddonEditorController/AddonEditorModel.swift	
+++ b/Crafty Craft 5/Tab Bar/Create Tab/Addon Creator/AddonEditorController/AddonEditorModel.swift	
@@ -120,7 +120,7 @@ class AddonEditorModel {
         
         let url = destination.appendingPathComponent(fileName)
         
-        if !fileManager.fileExists(atPath: fileName) {
+        if !fileManager.fileExists(atPath: url.path) {
             
             DropBoxParserFiles.shared.downloadBloodyFileBy(urlPath: mcAddonUri) { data in
                 do {
diff --git a/Crafty Craft 5/Tab Bar/Create Tab/Addon Creator/AddonEditorController/AddonEditorViewController.swift b/Crafty Craft 5/Tab Bar/Create Tab/Addon Creator/AddonEditorController/AddonEditorViewController.swift
index bbbc3b3..d306dee 100644
--- a/Crafty Craft 5/Tab Bar/Create Tab/Addon Creator/AddonEditorController/AddonEditorViewController.swift	
+++ b/Crafty Craft 5/Tab Bar/Create Tab/Addon Creator/AddonEditorController/AddonEditorViewController.swift	
@@ -421,7 +421,12 @@ extension AddonEditorViewController: ModPropertiesChangeable {
         queue.async(qos: .userInteractive) { [weak self] in
             guard let self else { return }
             self.model.localMCAddonFileUrl({ addonFileUrl in
-                guard let addonFileUrl else { return}
+                guard let addonFileUrl else {
+                    print("Error - Can't download addon from server")
+                    self.showAlert(title: "Error", message: "Can't download addon from server")
+                    self.hideSaveIndicatorView()
+                    return
+                }
                 var destinatioUrl = fileManger.documentDirectory.appendingPathComponent(addonFileUrl.lastPathComponent)
                 
                 if fileManger.secureSafeCopyItem(at: addonFileUrl, to: destinatioUrl), let addon {
diff --git a/Crafty Craft 5/Tab Bar/Create Tab/Addon Creator/AddonEditorController/AddonEditorViewController.xib b/Crafty Craft 5/Tab Bar/Create Tab/Addon Creator/AddonEditorController/AddonEditorViewController.xib
index 66fb60b..6c93e7b 100644
--- a/Crafty Craft 5/Tab Bar/Create Tab/Addon Creator/AddonEditorController/AddonEditorViewController.xib	
+++ b/Crafty Craft 5/Tab Bar/Create Tab/Addon Creator/AddonEditorController/AddonEditorViewController.xib	
@@ -1,6 +1,6 @@
 <?xml version="1.0" encoding="UTF-8"?>
 <document type="com.apple.InterfaceBuilder3.CocoaTouch.XIB" version="3.0" toolsVersion="22155" targetRuntime="iOS.CocoaTouch" propertyAccessControl="none" useAutolayout="YES" useTraitCollections="YES" useSafeAreas="YES" colorMatched="YES">
-    <device id="retina6_72" orientation="portrait" appearance="light"/>
+    <device id="ipad12_9rounded" orientation="portrait" layout="fullscreen" appearance="light"/>
     <dependencies>
         <deployment identifier="iOS"/>
         <plugIn identifier="com.apple.InterfaceBuilder.IBCocoaTouchPlugin" version="22131"/>
@@ -33,23 +33,23 @@
         </placeholder>
         <placeholder placeholderIdentifier="IBFirstResponder" id="-2" customClass="UIResponder"/>
         <view clearsContextBeforeDrawing="NO" contentMode="scaleToFill" id="i5M-Pr-FkT">
-            <rect key="frame" x="0.0" y="0.0" width="430" height="932"/>
+            <rect key="frame" x="0.0" y="0.0" width="1024" height="1366"/>
             <autoresizingMask key="autoresizingMask" widthSizable="YES" heightSizable="YES"/>
             <subviews>
                 <imageView clipsSubviews="YES" userInteractionEnabled="NO" contentMode="scaleAspectFill" horizontalHuggingPriority="251" verticalHuggingPriority="251" image="Green Background" translatesAutoresizingMaskIntoConstraints="NO" id="WXO-mn-rbc">
-                    <rect key="frame" x="0.0" y="0.0" width="430" height="932"/>
+                    <rect key="frame" x="0.0" y="0.0" width="1024" height="1366"/>
                 </imageView>
                 <view contentMode="scaleToFill" translatesAutoresizingMaskIntoConstraints="NO" id="JwL-Ju-YwI" userLabel="Navigation Bar">
-                    <rect key="frame" x="0.0" y="75" width="430" height="50"/>
+                    <rect key="frame" x="0.0" y="40" width="1024" height="80"/>
                     <subviews>
                         <label opaque="NO" userInteractionEnabled="NO" contentMode="left" horizontalHuggingPriority="251" verticalHuggingPriority="251" text="ADDON CREATOR" textAlignment="center" lineBreakMode="tailTruncation" baselineAdjustment="alignBaselines" adjustsFontSizeToFit="NO" translatesAutoresizingMaskIntoConstraints="NO" id="FZR-7h-eCj">
-                            <rect key="frame" x="50" y="8" width="330" height="34"/>
+                            <rect key="frame" x="80" y="8" width="864" height="64"/>
                             <fontDescription key="fontDescription" name="Blinker-SemiBold" family="Blinker" pointSize="28"/>
                             <color key="textColor" white="1" alpha="1" colorSpace="custom" customColorSpace="genericGamma22GrayColorSpace"/>
                             <nil key="highlightedColor"/>
                         </label>
                         <button opaque="NO" contentMode="scaleToFill" horizontalHuggingPriority="252" verticalHuggingPriority="252" horizontalCompressionResistancePriority="752" verticalCompressionResistancePriority="752" contentHorizontalAlignment="center" contentVerticalAlignment="center" lineBreakMode="middleTruncation" translatesAutoresizingMaskIntoConstraints="NO" id="hqg-iz-WnX" userLabel="Home Button">
-                            <rect key="frame" x="16" y="12" width="26" height="26"/>
+                            <rect key="frame" x="16" y="12" width="56" height="56"/>
                             <constraints>
                                 <constraint firstAttribute="width" secondItem="hqg-iz-WnX" secondAttribute="height" multiplier="1:1" id="f9z-E3-9ti"/>
                             </constraints>
@@ -60,7 +60,7 @@
                             </connections>
                         </button>
                         <button opaque="NO" contentMode="scaleToFill" horizontalHuggingPriority="251" verticalHuggingPriority="251" horizontalCompressionResistancePriority="751" verticalCompressionResistancePriority="751" contentHorizontalAlignment="center" contentVerticalAlignment="center" lineBreakMode="middleTruncation" translatesAutoresizingMaskIntoConstraints="NO" id="EoG-nA-FgJ" userLabel="saveBtn">
-                            <rect key="frame" x="388" y="12" width="26" height="26"/>
+                            <rect key="frame" x="952" y="12" width="56" height="56"/>
                             <constraints>
                                 <constraint firstAttribute="width" secondItem="EoG-nA-FgJ" secondAttribute="height" multiplier="1:1" id="Atb-x2-9cs"/>
                             </constraints>
@@ -89,25 +89,25 @@
                     </constraints>
                 </view>
                 <view contentMode="scaleToFill" translatesAutoresizingMaskIntoConstraints="NO" id="EX9-AM-HW7" userLabel="Button Container View">
-                    <rect key="frame" x="21.666666666666657" y="141" width="387" height="121"/>
+                    <rect key="frame" x="102.5" y="136" width="819" height="80"/>
                     <subviews>
                         <imageView clipsSubviews="YES" userInteractionEnabled="NO" contentMode="scaleAspectFit" horizontalHuggingPriority="251" verticalHuggingPriority="251" image="man button" translatesAutoresizingMaskIntoConstraints="NO" id="jNr-iq-40o" customClass="CustomImageLoader" customModule="Crafty_Craft_5" customModuleProvider="target">
-                            <rect key="frame" x="15.999999999999993" y="21.333333333333343" width="78.666666666666657" height="78.666666666666671"/>
+                            <rect key="frame" x="16" y="14" width="52" height="52"/>
                             <constraints>
                                 <constraint firstAttribute="width" secondItem="jNr-iq-40o" secondAttribute="height" multiplier="1:1" id="sch-fI-c2R"/>
                             </constraints>
                         </imageView>
                         <label opaque="NO" userInteractionEnabled="NO" contentMode="left" horizontalHuggingPriority="251" verticalHuggingPriority="251" text="SKIN EDITOR" textAlignment="natural" lineBreakMode="tailTruncation" baselineAdjustment="alignBaselines" adjustsFontSizeToFit="NO" translatesAutoresizingMaskIntoConstraints="NO" id="00R-Uj-Wdq">
-                            <rect key="frame" x="114.66666666666667" y="48.666666666666657" width="235.33333333333331" height="24"/>
+                            <rect key="frame" x="88" y="28" width="694" height="24"/>
                             <fontDescription key="fontDescription" name="Blinker-SemiBold" family="Blinker" pointSize="20"/>
                             <color key="textColor" white="0.0" alpha="1" colorSpace="custom" customColorSpace="genericGamma22GrayColorSpace"/>
                             <nil key="highlightedColor"/>
                         </label>
                         <activityIndicatorView opaque="NO" contentMode="scaleToFill" horizontalHuggingPriority="750" verticalHuggingPriority="750" style="large" translatesAutoresizingMaskIntoConstraints="NO" id="mLR-Hk-AoG">
-                            <rect key="frame" x="175" y="42" width="37" height="37"/>
+                            <rect key="frame" x="391" y="21.5" width="37" height="37"/>
                         </activityIndicatorView>
                         <imageView clipsSubviews="YES" userInteractionEnabled="NO" contentMode="scaleAspectFit" horizontalHuggingPriority="251" verticalHuggingPriority="251" image="Right Arrow Icon" translatesAutoresizingMaskIntoConstraints="NO" id="19v-cG-M0Q">
-                            <rect key="frame" x="355" y="48.666666666666657" width="24" height="24"/>
+                            <rect key="frame" x="787" y="28" width="24" height="24"/>
                             <constraints>
                                 <constraint firstAttribute="width" secondItem="19v-cG-M0Q" secondAttribute="height" multiplier="1:1" id="93g-Cn-vCc"/>
                                 <constraint firstAttribute="height" constant="24" id="gC0-GL-L8z"/>
@@ -120,6 +120,7 @@
                         <constraint firstItem="19v-cG-M0Q" firstAttribute="centerY" secondItem="EX9-AM-HW7" secondAttribute="centerY" id="87C-BW-ddr"/>
                         <constraint firstItem="00R-Uj-Wdq" firstAttribute="centerY" secondItem="EX9-AM-HW7" secondAttribute="centerY" id="AQm-l9-P69"/>
                         <constraint firstItem="mLR-Hk-AoG" firstAttribute="centerX" secondItem="EX9-AM-HW7" secondAttribute="centerX" id="D61-4U-vh2"/>
+                        <constraint firstAttribute="height" constant="80" id="Iu5-a2-nIl"/>
                         <constraint firstItem="00R-Uj-Wdq" firstAttribute="leading" secondItem="jNr-iq-40o" secondAttribute="trailing" constant="20" id="JIt-rZ-aY0"/>
                         <constraint firstItem="jNr-iq-40o" firstAttribute="centerX" secondItem="EX9-AM-HW7" secondAttribute="centerX" priority="999" id="KR1-ym-994"/>
                         <constraint firstItem="jNr-iq-40o" firstAttribute="leading" secondItem="EX9-AM-HW7" secondAttribute="leading" constant="16" id="NF3-RB-ZKE"/>
@@ -128,16 +129,26 @@
                         <constraint firstItem="mLR-Hk-AoG" firstAttribute="centerY" secondItem="EX9-AM-HW7" secondAttribute="centerY" id="VyE-Xx-xbJ"/>
                         <constraint firstItem="19v-cG-M0Q" firstAttribute="leading" secondItem="00R-Uj-Wdq" secondAttribute="trailing" constant="5" id="aP3-yC-Jcn"/>
                     </constraints>
+                    <variation key="default">
+                        <mask key="constraints">
+                            <exclude reference="Iu5-a2-nIl"/>
+                        </mask>
+                    </variation>
+                    <variation key="heightClass=regular-widthClass=regular">
+                        <mask key="constraints">
+                            <include reference="Iu5-a2-nIl"/>
+                        </mask>
+                    </variation>
                 </view>
                 <tableView clipsSubviews="YES" contentMode="scaleToFill" alwaysBounceVertical="YES" showsHorizontalScrollIndicator="NO" style="plain" separatorStyle="default" allowsSelection="NO" rowHeight="-1" estimatedRowHeight="-1" sectionHeaderHeight="-1" estimatedSectionHeaderHeight="-1" sectionFooterHeight="-1" estimatedSectionFooterHeight="-1" translatesAutoresizingMaskIntoConstraints="NO" id="Zoa-9r-dBV" userLabel="addonMainInfoTable">
-                    <rect key="frame" x="21.666666666666657" y="286" width="387" height="596"/>
+                    <rect key="frame" x="102.5" y="240" width="819" height="1090"/>
                     <color key="backgroundColor" white="0.0" alpha="0.0" colorSpace="custom" customColorSpace="genericGamma22GrayColorSpace"/>
                 </tableView>
                 <view hidden="YES" userInteractionEnabled="NO" contentMode="scaleToFill" translatesAutoresizingMaskIntoConstraints="NO" id="Fha-Qj-O0v">
-                    <rect key="frame" x="0.0" y="0.0" width="430" height="932"/>
+                    <rect key="frame" x="0.0" y="0.0" width="1024" height="1366"/>
                     <subviews>
                         <activityIndicatorView opaque="NO" contentMode="scaleToFill" horizontalHuggingPriority="750" verticalHuggingPriority="750" hidesWhenStopped="YES" animating="YES" style="large" translatesAutoresizingMaskIntoConstraints="NO" id="G0b-By-CDK">
-                            <rect key="frame" x="196.66666666666666" y="447.66666666666669" width="37" height="37"/>
+                            <rect key="frame" x="493.5" y="664.5" width="37" height="37"/>
                             <color key="tintColor" white="0.0" alpha="1" colorSpace="custom" customColorSpace="genericGamma22GrayColorSpace"/>
                             <color key="color" white="0.0" alpha="1" colorSpace="custom" customColorSpace="genericGamma22GrayColorSpace"/>
                         </activityIndicatorView>
@@ -163,42 +174,43 @@
                 <constraint firstItem="fnl-2z-Ty3" firstAttribute="bottom" secondItem="Zoa-9r-dBV" secondAttribute="bottom" constant="16" id="Sz5-bj-frP"/>
                 <constraint firstItem="WXO-mn-rbc" firstAttribute="top" secondItem="i5M-Pr-FkT" secondAttribute="top" id="V3V-E7-Z7V"/>
                 <constraint firstItem="Fha-Qj-O0v" firstAttribute="trailing" secondItem="fnl-2z-Ty3" secondAttribute="trailing" id="WfR-OT-JLg"/>
-                <constraint firstItem="Zoa-9r-dBV" firstAttribute="width" secondItem="i5M-Pr-FkT" secondAttribute="width" multiplier="0.65" id="ZAO-WS-fUb"/>
+                <constraint firstItem="Zoa-9r-dBV" firstAttribute="width" secondItem="i5M-Pr-FkT" secondAttribute="width" multiplier="0.8" id="ZAO-WS-fUb"/>
                 <constraint firstItem="EX9-AM-HW7" firstAttribute="width" secondItem="i5M-Pr-FkT" secondAttribute="width" multiplier="0.9" id="aIg-mH-Sb3"/>
                 <constraint firstItem="Fha-Qj-O0v" firstAttribute="leading" secondItem="fnl-2z-Ty3" secondAttribute="leading" id="bNZ-hf-tGR"/>
                 <constraint firstItem="WXO-mn-rbc" firstAttribute="leading" secondItem="i5M-Pr-FkT" secondAttribute="leading" id="dLg-R5-tZn"/>
                 <constraint firstItem="Fha-Qj-O0v" firstAttribute="top" secondItem="i5M-Pr-FkT" secondAttribute="top" id="dz5-cL-l5v"/>
                 <constraint firstAttribute="trailing" secondItem="WXO-mn-rbc" secondAttribute="trailing" id="jll-62-0Bh"/>
-                <constraint firstItem="EX9-AM-HW7" firstAttribute="width" secondItem="i5M-Pr-FkT" secondAttribute="width" multiplier="0.6" id="osn-dX-jus"/>
+                <constraint firstItem="EX9-AM-HW7" firstAttribute="width" secondItem="Zoa-9r-dBV" secondAttribute="width" id="lRS-eo-VvI"/>
                 <constraint firstAttribute="bottom" secondItem="Fha-Qj-O0v" secondAttribute="bottom" id="s4I-54-eEG"/>
                 <constraint firstItem="JwL-Ju-YwI" firstAttribute="top" secondItem="fnl-2z-Ty3" secondAttribute="top" constant="16" id="srf-52-S8X"/>
                 <constraint firstItem="Zoa-9r-dBV" firstAttribute="top" secondItem="EX9-AM-HW7" secondAttribute="bottom" constant="24" id="txz-mF-KI9"/>
             </constraints>
             <variation key="default">
                 <mask key="constraints">
-                    <exclude reference="aIg-mH-Sb3"/>
-                    <exclude reference="osn-dX-jus"/>
                     <exclude reference="1n5-2x-bj2"/>
                     <exclude reference="ZAO-WS-fUb"/>
+                    <exclude reference="aIg-mH-Sb3"/>
+                    <exclude reference="lRS-eo-VvI"/>
                 </mask>
             </variation>
             <variation key="heightClass=compact-widthClass=compact">
                 <mask key="constraints">
-                    <include reference="aIg-mH-Sb3"/>
                     <include reference="1n5-2x-bj2"/>
+                    <include reference="aIg-mH-Sb3"/>
                 </mask>
             </variation>
             <variation key="heightClass=regular-widthClass=compact">
                 <mask key="constraints">
-                    <include reference="aIg-mH-Sb3"/>
                     <include reference="1n5-2x-bj2"/>
+                    <include reference="aIg-mH-Sb3"/>
                 </mask>
             </variation>
             <variation key="heightClass=regular-widthClass=regular">
                 <mask key="constraints">
-                    <exclude reference="aIg-mH-Sb3"/>
-                    <include reference="osn-dX-jus"/>
                     <include reference="ZAO-WS-fUb"/>
+                    <exclude reference="aIg-mH-Sb3"/>
+                    <exclude reference="Pww-N9-NTm"/>
+                    <include reference="lRS-eo-VvI"/>
                 </mask>
             </variation>
             <point key="canvasLocation" x="54.418604651162788" y="-11.587982832618026"/>
diff --git a/Crafty Craft 5/Tab Bar/Create Tab/CreateTabViewController.swift b/Crafty Craft 5/Tab Bar/Create Tab/CreateTabViewController.swift
index 2ca6974..eacc9bd 100755
--- a/Crafty Craft 5/Tab Bar/Create Tab/CreateTabViewController.swift	
+++ b/Crafty Craft 5/Tab Bar/Create Tab/CreateTabViewController.swift	
@@ -221,6 +221,7 @@ final class CreateTabViewController: UIViewController {
             self.state = .addon
 
         }
+        searchBarView.searchTextField.resignFirstResponder()
         self.flushSearch()
     }
     
diff --git a/Crafty Craft 5/Tab Bar/Create Tab/SkinsCreator/ListOfCreatedSkinsController/Skin3DCreator/Skin3DTestViewController.swift b/Crafty Craft 5/Tab Bar/Create Tab/SkinsCreator/ListOfCreatedSkinsController/Skin3DCreator/Skin3DTestViewController.swift
index c291a45..1622bac 100755
--- a/Crafty Craft 5/Tab Bar/Create Tab/SkinsCreator/ListOfCreatedSkinsController/Skin3DCreator/Skin3DTestViewController.swift	
+++ b/Crafty Craft 5/Tab Bar/Create Tab/SkinsCreator/ListOfCreatedSkinsController/Skin3DCreator/Skin3DTestViewController.swift	
@@ -428,6 +428,8 @@ class Skin3DTestViewController: UIViewController {
     private func setupDownloadAndShareButtons() {
         
         let stackHeight: CGFloat = 54
+        let containerHeight: CGFloat = 104
+        
         let button1 = UIButton()
         button1.setTitle("Download", for: .normal)
         button1.backgroundColor = UIColor(named: "greenCCRedesign")
@@ -459,17 +461,19 @@ class Skin3DTestViewController: UIViewController {
         button1.translatesAutoresizingMaskIntoConstraints = false
         shareButton.translatesAutoresizingMaskIntoConstraints = false
         
+        let containerViewFlexibleConstraint = UIDevice.current.userInterfaceIdiom == .pad ? containerView.heightAnchor.constraint(equalTo: toolsStackView.heightAnchor) : containerView.heightAnchor.constraint(equalToConstant: containerHeight)
+        
         NSLayoutConstraint.activate([
-            
+            //containerConstraints
             containerView.leadingAnchor.constraint(equalTo: view.leadingAnchor, constant: 0),
             containerView.trailingAnchor.constraint(equalTo: view.trailingAnchor, constant: 0),
             containerView.bottomAnchor.constraint(equalTo: view.bottomAnchor, constant: 0),
-            containerView.heightAnchor.constraint(equalToConstant: 104),
+            containerViewFlexibleConstraint,
 
             //stackConstraints
             stackView.leadingAnchor.constraint(equalTo: containerView.leadingAnchor, constant: 32),
             stackView.trailingAnchor.constraint(equalTo: containerView.trailingAnchor, constant: -32),
-            stackView.topAnchor.constraint(equalTo: containerView.topAnchor, constant: 10),
+            stackView.centerYAnchor.constraint(equalTo: containerView.centerYAnchor),
             stackView.heightAnchor.constraint(equalToConstant: stackHeight),
         ])
     }
-- 
2.37.0

